<script>
    const data = [
        {
            name: 'Kupione',
            observed: [
                { code: 'BETAW20TR.PL', name: 'Beta ETF WIG20TR' },
            ]
        },
        {
            name: 'Do Kupienia',
            observed: [
            ]
        },
        {
            name: 'Co się dzieje',
            observed: [
                { code: 'WIG', name: 'WIG' },
                { code: '^SPX', name: 'S&P 500 - U.S.' },
                { code: '^DAX', name: 'DAX Index - Germany' },
                { code: '10PLY.B', name: '10-Year Poland Bond Yield' },
                { code: '10USY.B', name: '10-Year U.S. Bond Yield' },
                { code: '10DEY.B', name: '10-Year German Bond Yield' },
            ]
        },
        {
            name: 'Waluty',
            observed: [
                { code: 'USDPLN', name: 'USDPLN' },
                { code: 'EURPLN', name: 'EURPLN' },
                { code: 'CHFPLN', name: 'CHFPLN' },
                { code: 'NOKPLN', name: 'NOKPLN' },
                { code: 'SEKPLN', name: 'SEKPLN' },
            ]
        },
        {
            name: 'GPW Indeksy',
            observed: [
                { code: 'WIG20', name: 'WIG20' },
                { code: 'WIG20TR', name: 'WIG20TR' },
                { code: 'WIG20_PE', name: 'WIG20_PE' },
                { code: 'MWIG40', name: 'MWIG40' },
                { code: 'MWIG40TR', name: 'MWIG40TR' },
                { code: 'MWIG40_PE', name: 'MWIG40_PE' },
                { code: 'SWIG80', name: 'SWIG80' },
                { code: 'SWIG80TR', name: 'SWIG80TR' },
                { code: 'SWIG80_PE', name: 'SWIG80_PE' },
                { code: 'WIG20Short', name: 'WIG20Short' },
            ]
        },
        {
            name: 'GPW Branże',
            observed: [
                { code: 'WIG_BANKI', name: 'WIG_BANKI' },
                { code: 'WIG_ENERG', name: 'WIG_ENERG' },
                { code: 'WIG_PALIWA', name: 'WIG_PALIWA' },
                { code: 'WIG_CHEMIA', name: 'WIG_CHEMIA' },
                { code: 'WIG_GAMES', name: 'WIG_GAMES' },
                { code: 'WIG_NRCHOM', name: 'WIG_NRCHOM' },
                { code: 'WIG_BUDOW', name: 'WIG_BUDOW' },
                { code: 'WIG_GORNIC', name: 'WIG_GORNIC' },
                { code: 'WIG_INFO', name: 'WIG_INFO' },
                { code: 'WIG_LEKI', name: 'WIG_LEKI' },
                { code: 'WIG_MEDIA', name: 'WIG_MEDIA' },
                { code: 'WIG_SPOZYW', name: 'WIG_SPOZYW' },
                { code: 'WIG_TELEKOM', name: 'WIG_TELEKOM' },
            ]
        },
        {
            name: 'Obserwowane',
            observed: [
                { code: 'KRU', name: 'Kruk' },
                { code: 'ALR', name: 'Alior' },
                { code: 'EAH', name: 'Esotiq & Henderson' },
                { code: 'CCC', name: 'CCC' },
                { code: 'QRS', name: 'Quercus' },
                { code: 'KRU', name: 'Kruk' },
                { code: 'TPE', name: 'Tauron' },
                { code: 'CIE', name: 'Ciech' },
                { code: 'AMC', name: 'Amica' },
                { code: 'SNK', name: 'Sanok' },
                { code: 'BHW', name: 'Handlowy' },
            ]
        },
        {
            name: 'Certyfikaty',
            observed: [
                { code: 'RCFL2SILVE.PL', name: 'Silver Fut Long x2' },
                { code: 'URA.US', name: 'Global X Uranium ETF' },
            ]
        },
        {
            name: 'inPZU',
            observed: [
                { code: '20684.N', name: 'inPZU Akcje Polskie' },
                { code: '20683.N', name: 'inPZU Akcje Rynków Rozwiniętych' },
                { code: '20681.N', name: 'inPZU Obligacje Polskie' },
                { code: '20680.N', name: 'inPZU Obligacje Rynków Rozwiniętych' },
                { code: '20679.N', name: 'inPZU Obligacje Rynków Wschodzących' },
                { code: '20682.N', name: 'inPZU Inwestycji Ostrożnych' },
            ],
            compared: [
                { codes: ['20684.N', '20683.N'], name: 'Akcje' },
                { codes: ['20681.N', '20680.N', '20679.N'], name: 'Obligacje' },
            ]
        },
        {
            name: 'nnTFI',
            observed: [
                { code: '2802.N', name: 'NN Obligacji K' },
                { code: '2790.N', name: 'NN Gotówkowy K' },
                { code: '2795.N', name: 'NN Lokacyjny Plus K' },
                { code: '2781.N', name: 'NN Akcji K' },
                { code: '2828.N', name: 'NN Perspektywa 2045 SFIO K' },
            ],
            compared: [
                { codes: ['2790.N', '2795.N', '2802.N', '2781.N'], name: 'Porównanie' },
            ]
        },
        {
            name: 'Unikorona',
            observed: [
                { code: '3961.N', name: 'UniFundusze FIO Subfundusz UniKorona Dochodowy' },
                { code: '3960.N', name: 'UniFundusze FIO Subfundusz UniKorona Obligacje' },
                { code: '3964.N', name: 'UniFundusze FIO Subfundusz UniObligacje Nowa Europa' },
                { code: '3953.N', name: 'UniFundusze FIO Subfundusz UniAkcje Dywidendowy' },
                { code: '3959.N', name: 'UniFundusze FIO Subfundusz UniKorona Akcje' },
                { code: '3954.N', name: 'UniFundusze FIO Subfundusz UniAkcje Małych i Średnich Spółek' },
            ],
            compared: [
                { codes: ['3953.N', '3959.N', '3954.N'], name: 'Akcje' },
                { codes: ['3961.N', '3960.N', '3964.N'], name: 'Obligacje' },
            ]
        },
        {
            name: 'Porównanie',
            compared: [
                { codes: ['WIG', 'WIG20', '3959.N', '2781.N', '20684.N'], name: 'Akcje' },
                { codes: ['MWIG40', 'SWIG80', '3954.N'], name: 'Misie' },
            ]
        },
    ]

    let time = '3y'
    let scale = 'ln'
    let type = 'c'
</script>

<html>

<head>
    <meta charset="UTF-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.core.min.js"></script>
    <link rel="icon" href="http://static.stooq.pl/favicon.ico">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <style>
        img {
            width: 100%;
            margin: 20px 0;
        }

        .row {
            margin: 50px 50px 0 50px;
        }

        .radio-item {
            padding-right: 10px;
        }

        .card {
            margin: 5px;
        }

        .col-xl-4,
        .col-lg-6,
        .col-md-12 {
            padding-left: 0;
            padding-right: 0;
        }

        .control {
            padding-right: 2em;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <div class="card" style="width: 100%">
                <div class="card-body">
                    <div>
                        <span class="control">
                            <span class="radio-item"><input type="radio" name="time" value="30y"> 30y</span>
                            <span class="radio-item"><input type="radio" name="time" value="20y"> 20y</span>
                            <span class="radio-item"><input type="radio" name="time" value="10y"> 10y</span>
                            <span class="radio-item"><input type="radio" name="time" value="5y"> 5y</span>
                            <span class="radio-item"><input type="radio" name="time" value="3y" checked> 3y</span>
                            <span class="radio-item"><input type="radio" name="time" value="1y"> 1y</span>
                            <span class="radio-item"><input type="radio" name="time" value="5m"> 5m</span>
                            <span class="radio-item"><input type="radio" name="time" value="3m"> 3m</span>
                            <span class="radio-item"><input type="radio" name="time" value="1m"> 1m</span>
                            <span class="radio-item"><input type="radio" name="time" value="10d"> 10d</span>
                            <span class="radio-item"><input type="radio" name="time" value="5d"> 5d</span>
                            <span class="radio-item"><input type="radio" name="time" value="3d"> 3d</span>
                            <span class="radio-item"><input type="radio" name="time" value="1d"> 1d</span>
                        </span>


                        <span class="control">
                            <span class="radio-item"><input type="radio" name="type" value="c" checked> Candles</span>
                            <span class="radio-item"><input type="radio" name="type" value="l"> Line</span>
                        </span>

                        <span class="control">
                            <button class="submit btn btn-light">OK</button>
                        </span>

                        <span class="control">
                            <select class="data-type-selector" onchange="onDataTypeChange(this);">
                            </select>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="stocks row">
        </div>
    </div>
</body>

<script>
    function imgLink(codes) {
        if (Array.isArray(codes)) {
            const first = codes[0]
            const rest = codes.slice(1).join('+')

            return `https://stooq.pl/c/?s=${first}&c=${time}&t=${type}&a=${scale}&r=${rest}`
        } else {
            return `https://stooq.pl/c/?s=${codes}&c=${time}&t=${type}&a=${scale}`
        }
    }

    function buildCard(code, name) {
        let title = code === name ? code : name + ' (' + code + ')'
        return `<div class="col-xl-4 col-lg-6 col-md-12">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">${title}</h5>
                                <a href="https://stooq.pl/q/a2/?s=${code}&i=d&t=c&a=lg&z=433&l=0&d=1&ch=1&f=1&lt=57&r=0&o=1">
                                    <img src="${imgLink(code)}" alt="${code}">
                                </a>
                            </div>
                        </div>
                    </div>`
    }

    function onDataTypeChange(selected) {
        const type = _.find(data, t => t.name === selected.value);
        const $stocks = $('.stocks');

        $stocks.empty();

        (type.observed || []).forEach(function (stock) {
            const html = buildCard(stock.code, stock.name)
            $stocks.append(html);
        });

        (type.compared || []).forEach(function (group) {
            const html = buildCard(group.codes, group.name)
            $stocks.append(html);
        });
    }

    $('.submit').click(function (event) {
        event.preventDefault();
        time = $('input[name="time"]:checked').val();
        type = $('input[name="type"]:checked').val();

        $(".stocks img").each(function () {
            $(this).attr('src', imgLink($(this).attr('alt').split(',')))
        });
    });

    _.map(data, 'name').forEach(name =>
        $('.data-type-selector').append(`<option value="${name}">${name}</option>`))

    onDataTypeChange({ value: data[0].name });
</script>

</html>